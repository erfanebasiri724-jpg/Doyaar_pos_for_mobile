<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ú©Ø§ÙÙ‡ Ø¨Ø³ØªÙ†ÛŒ Ø¯ÙˆÛŒØ§Ø± â€” POS Ù…ÙˆØ¨Ø§ÛŒÙ„</title>
<style>
:root{
  --bg:#fff7fb;
  --accent:#d18cd1;
  --accent-2:#b069c2;
  --panel:#ffffff;
  --muted:#666;
  --highlight:#fff176;
  --card-shadow: 0 6px 18px rgba(0,0,0,0.06);
  --radius:12px;
  --danger:#ef5350;
}

/* reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  font-family: "Segoe UI", Tahoma, "Helvetica Neue", sans-serif;
  color:#222;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  direction:rtl;
}

/* header */
.header{
  background:linear-gradient(90deg,var(--accent),#e7a7e9);
  color:white;
  padding:14px 12px;
  text-align:center;
  font-weight:700;
  font-size:18px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

/* top info row */
.top-row{
  display:flex;
  justify-content:space-between;
  gap:8px;
  padding:10px;
  align-items:center;
}
.info-pill{
  background:var(--panel);
  border-radius:10px;
  padding:8px 10px;
  box-shadow:var(--card-shadow);
  font-size:14px;
}
.info-pill strong{display:block;font-size:16px}

/* main layout: invoice stack + product area */
.main{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  padding-bottom:120px; /* space for bottom controls */
}

/* invoice area (middle) */
.invoice{
  background:var(--panel);
  border-radius:var(--radius);
  box-shadow:var(--card-shadow);
  padding:10px;
  min-height:160px;
  max-height:46vh;
  overflow:auto;
}
.inv-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 4px;
  border-radius:8px;
}
.inv-row.header{
  font-weight:700;
  color:var(--muted);
  font-size:13px;
  border-bottom:1px dashed #eee;
}
.inv-item{
  display:flex;
  justify-content:space-between;
  gap:8px;
  padding:8px 4px;
  align-items:center;
  border-bottom:1px solid #f2f2f2;
}
.inv-item .name{flex:1; font-size:15px;}
.qty-controls button{
  background:var(--accent);
  color:white;border:none;padding:6px 8px;border-radius:6px;margin:0 2px;font-weight:700;
}
.inv-item small{color:var(--muted);display:block;font-size:12px;margin-top:4px}

/* total bar */
.total-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:8px;
  padding:8px;
  background:linear-gradient(90deg,#fff,#fff0fb);
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,0.03);
}
.total-bar .left{font-size:14px;color:var(--muted)}
.total-bar .right{font-weight:800;font-size:18px;color:var(--accent-2)}

/* bottom controls (sticky) */
.bottom-controls{
  position:fixed;
  left:10px; right:10px; bottom:10px;
  display:flex; gap:8px; align-items:center;
  justify-content:space-between;
  z-index:50;
}
.small-btn{
  background:var(--panel); padding:10px;border-radius:12px; box-shadow:var(--card-shadow);
  display:flex;align-items:center;gap:8px;border:none;font-weight:700;cursor:pointer;
}
.primary-btn{
  background:linear-gradient(180deg,var(--accent),var(--accent-2));
  color:white;padding:12px 16px;border-radius:14px;border:none;font-weight:800;box-shadow:0 6px 18px rgba(177,88,179,0.18);
}

/* categories scroller */
.cat-scroll{
  display:flex; gap:8px; overflow:auto; padding:10px 2px 2px 2px;
  margin-top:6px;
}
.cat-btn{
  min-width:96px; flex:0 0 auto; padding:10px 12px; border-radius:12px; background:linear-gradient(180deg,#fff,#fff0ff);
  border:1px solid rgba(0,0,0,0.03); text-align:center; font-weight:700; cursor:pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.04);
}
.cat-btn.active{outline:3px solid rgba(196,98,182,0.12)}

/* product grid (sheet) */
.prod-sheet{
  position:fixed; left:0; right:0; bottom:76px;
  max-height:55vh; height:45vh; background:var(--panel); border-top-left-radius:16px; border-top-right-radius:16px;
  box-shadow:0 -6px 18px rgba(0,0,0,0.08); padding:10px; overflow:auto; transform:translateY(0);
  z-index:60;
}
.prod-grid{
  display:grid; grid-template-columns:repeat(3,1fr); gap:8px;
}
.prod-card{
  background:linear-gradient(180deg,#fff,#fff7ff); padding:10px; border-radius:12px; text-align:center; cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,0.04); font-weight:800; font-size:13px;
}
.prod-price{display:block;margin-top:6px;font-weight:700;color:var(--accent-2);font-size:12px}

/* search box */
.search-wrap{position:relative;margin-bottom:6px}
#searchBar{width:100%;padding:10px;border-radius:10px;border:1px solid #e6d6e6;font-size:15px}
.search-results{
  position:absolute; left:0; right:0; top:44px; background:var(--panel); border-radius:10px; box-shadow:var(--card-shadow);
  max-height:220px; overflow:auto; z-index:70; display:none;
}
.search-item{
  padding:10px; border-bottom:1px solid #f2f2f2; display:flex; justify-content:space-between; align-items:center;
}
.search-item:last-child{border-bottom:none}
.search-item button{background:var(--accent); color:white; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:700}

/* small helpers */
.empty-note{padding:18px;text-align:center;color:var(--muted);font-weight:600}
.remove-btn{background:transparent;border:1px dashed #f4c; color:var(--danger); padding:6px 8px;border-radius:8px}

/* invoice print hidden style - used when printing */
@media print{
  body *:not(.invoicePrint){display:none!important}
  .invoicePrint{display:block!important}
}

/* responsive tweaks */
@media(min-width:900px){
  .prod-sheet{left:50%;transform:translateX(-50%);width:720px;border-radius:10px}
  .prod-grid{grid-template-columns:repeat(4,1fr)}
}
</style>
</head>
<body>

<div class="header">Ú©Ø§ÙÙ‡ Ø¨Ø³ØªÙ†ÛŒ Ø¯ÙˆÛŒØ§Ø± â€” ØµÙ†Ø¯ÙˆÙ‚ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ÛŒ (Ù…ÙˆØ¨Ø§ÛŒÙ„)</div>

<div class="main">
  <div class="top-row">
    <div style="flex:1">
      <div class="info-pill">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="text-align:left"><small>Ø§Ù‚Ù„Ø§Ù…</small><br><strong id="cartCountTop">0</strong></div>
          <div style="text-align:right"><small>Ø¬Ù…Ø¹ Ú©Ù„</small><br><strong id="cartTotalTop">0</strong> ØªÙˆÙ…Ø§Ù†</div>
        </div>
      </div>
    </div>
    <div style="width:120px">
      <div class="info-pill" id="currentTime">â€”</div>
    </div>
  </div>

  <div class="search-wrap">
    <input id="searchBar" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ú©Ù† (Ù…Ø«Ù„Ø§Ù‹ 'Ø¢Ø¨ Ù‡ÙˆÛŒØ¬' ÛŒØ§ 'Ù‡ÙˆÛŒØ¬')">
    <div id="searchResults" class="search-results"></div>
  </div>

  <div class="invoice" id="invoice">
    <div class="inv-row header">
      <div style="width:48%;">Ù…Ø­ØµÙˆÙ„</div>
      <div style="width:18%;text-align:center">ØªØ¹Ø¯Ø§Ø¯</div>
      <div style="width:22%;text-align:left">Ø¬Ù…Ø¹</div>
    </div>
    <div id="invList"></div>
    <div id="emptyNote" class="empty-note">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª â€” Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø¯Ø³ØªÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† Ùˆ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†</div>
  </div>

  <div class="total-bar" style="margin-top:8px">
    <div class="left">ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§: <span id="itemsCount">0</span></div>
    <div class="right" id="totalSum">0 ØªÙˆÙ…Ø§Ù†</div>
  </div>

  <div class="cat-scroll" id="catScroll"></div>

</div>

<!-- product sheet (bottom) -->
<div class="prod-sheet" id="prodSheet" aria-hidden="true" style="display:none">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
    <div style="font-weight:800">Ù…Ø­ØµÙˆÙ„Ø§Øª</div>
    <div><button class="small-btn" id="closeProducts">Ø¨Ø³ØªÙ†</button></div>
  </div>
  <div class="prod-grid" id="prodGrid"></div>
</div>

<!-- bottom controls -->
<div class="bottom-controls">
  <div style="display:flex;gap:8px;flex:1">
    <button class="small-btn" id="emptyCartBtnMobile">ğŸ—‘ Ø®Ø§Ù„ÛŒ</button>
    <button class="small-btn" id="printBtnMobile">ğŸ–¨ Ú†Ø§Ù¾</button>
    <button class="small-btn" id="clearSearch">âœ– Ø¬Ø³ØªØ¬Ùˆ</button>
  </div>
  <div>
    <button class="primary-btn" id="checkoutBtn">Ø«Ø¨Øª ÙØ§Ú©ØªÙˆØ±</button>
  </div>
</div>

<!-- hidden invoice print area -->
<div class="invoicePrint" id="invoicePrint" style="display:none">
  <div style="text-align:center;font-weight:800;font-size:20px">Ú©Ø§ÙÙ‡ Ø¨Ø³ØªÙ†ÛŒ Ø¯ÙˆÛŒØ§Ø±</div>
  <hr>
  <div id="printBody"></div>
  <hr>
  <div>Ø¬Ù…Ø¹ Ú©Ù„: <strong id="printTotal"></strong> ØªÙˆÙ…Ø§Ù†</div>
  <div style="margin-top:12px">ØªØ§Ø±ÛŒØ®: <span id="printDate"></span></div>
</div>

<script>
// ====== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (Ù…Ø­ØµÙˆÙ„Ø§Øª ØªÙˆ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§) ======
const productsData = [
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ø³Ù†ØªÛŒ Ø¨Ø¯ÙˆÙ† Ù…ØºØ²",price:220000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ø³Ù†ØªÛŒ Ù…ØºØ²Ø¯Ø§Ø±",price:260000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ø³Ù†ØªÛŒ Ù„ÛŒÙˆØ§Ù†ÛŒ",price:40000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø·Ø§Ù„Ø¨ÛŒ Ø¨Ø³ØªÙ†ÛŒ",price:70000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¢Ø¨ Ù‡ÙˆÛŒØ¬ Ø¨Ø³ØªÙ†ÛŒ",price:60000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ø§Ø³Ú©ÙˆÙ¾ÛŒ",price:25000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ù‚ÛŒÙÛŒ ÙˆØ§Ù†ÛŒÙ„ÛŒ",price:35000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ù‚ÛŒÙÛŒ ÙˆØ§Ù†ÛŒÙ„ Ú©Ø§Ú©Ø§Ø¦Ùˆ",price:40000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡ÛŒ Ù„ÛŒÙˆØ§Ù† Ø¨Ø²Ø±Ú¯",price:50000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø³ØªÙ†ÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡ÛŒ Ù„ÛŒÙˆØ§Ù† Ú©ÙˆÚ†Ú©",price:40000,category:"Ø¨Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§"},
  {name:"ÙØ§Ù„ÙˆØ¯Ù‡",price:50000,category:"ÙØ§Ù„ÙˆØ¯Ù‡"},
  {name:"ÙØ§Ù„ÙˆØ¯Ù‡ Ø¨Ø³ØªÙ†ÛŒ",price:70000,category:"ÙØ§Ù„ÙˆØ¯Ù‡"},
  {name:"Ø¢Ø¨ Ù‡ÙˆÛŒØ¬",price:40000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ø§Ù†Ø§Ø±",price:90000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ø²Ø±Ø´Ú©",price:90000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ø³ÛŒØ¨",price:70000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ø·Ø§Ù„Ø¨ÛŒ",price:60000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡",price:60000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ø¢Ù„Ø¨Ø§Ù„Ùˆ",price:60000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø¢Ø¨ Ù¾Ø±ØªØºØ§Ù„",price:80000,category:"Ø¢Ø¨Ù…ÛŒÙˆÙ‡"},
  {name:"Ø´ÛŒØ± Ù…ÙˆØ²",price:80000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø´ÛŒØ± Ù…ÙˆØ² Ø®Ø±Ù…Ø§",price:120000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø´ÛŒØ± Ù…ÙˆØ² Ú¯Ø±Ø¯Ùˆ",price:150000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø´ÛŒØ± Ù¾Ø³ØªÙ‡",price:150000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø´ÛŒØ± Ø§Ù†Ø¨Ù‡",price:180000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø´ÛŒØ± Ù…ÙˆØ² Ø¨Ø³ØªÙ†ÛŒ",price:100000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø´ÛŒÚ©",price:120000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ø¢ÛŒØ³ Ù¾Ú©",price:120000,category:"Ø´ÛŒØ±Ù‡Ø§ Ùˆ Ø´ÛŒÚ©â€ŒÙ‡Ø§"},
  {name:"Ù…Ø¹Ø¬ÙˆÙ† Ù„ÛŒÙˆØ§Ù†ÛŒ",price:160000,category:"Ù…Ø¹Ø¬ÙˆÙ† Ùˆ Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ"},
  {name:"Ù…Ø¹Ø¬ÙˆÙ† Ú©Ø§Ø³Ù‡â€ŒØ§ÛŒ Ú©ÙˆÚ†Ú©",price:180000,category:"Ù…Ø¹Ø¬ÙˆÙ† Ùˆ Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ"},
  {name:"Ù…Ø¹Ø¬ÙˆÙ† Ú©Ø§Ø³Ù‡â€ŒØ§ÛŒ Ø¨Ø²Ø±Ú¯",price:250000,category:"Ù…Ø¹Ø¬ÙˆÙ† Ùˆ Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ"},
  {name:"Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ Ù„ÛŒÙˆØ§Ù†ÛŒ",price:70000,category:"Ù…Ø¹Ø¬ÙˆÙ† Ùˆ Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ"},
  {name:"Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ Ù…Ø®ØµÙˆØµ",price:150000,category:"Ù…Ø¹Ø¬ÙˆÙ† Ùˆ Ú©ÛŒÚ© Ø¨Ø³ØªÙ†ÛŒ"},
  {name:"Ø°Ø±Øª Ù…Ú©Ø²ÛŒÚ©ÛŒ Ú©ÙˆÚ†Ú©",price:90000,category:"Ø°Ø±Øªâ€ŒÙ‡Ø§"},
  {name:"Ø°Ø±Øª Ù…Ú©Ø²ÛŒÚ©ÛŒ Ø¨Ø²Ø±Ú¯",price:130000,category:"Ø°Ø±Øªâ€ŒÙ‡Ø§"},
  {name:"Ú©ÛŒÚ© Ø´Ú©Ù„Ø§ØªÛŒ",price:90000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ø¢Ø¨ Ù…Ø¹Ø¯Ù†ÛŒ Ú©ÙˆÚ†Ú©",price:10000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ø¢Ø¨ Ù…Ø¹Ø¯Ù†ÛŒ Ø¨Ø²Ø±Ú¯",price:15000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ù„Ø§ÛŒÙ",price:50000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ù‡Ø§ÛŒÙ¾",price:60000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ú©ÛŒÙ†Ú¯",price:45000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ú©Ø±ÙˆÙ†Ø§",price:150000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"ÙˆÛŒØªØ§Ù…ÛŒÙ† Ø³ÛŒ",price:40000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ Ú¯ÛŒØ§Ù‡ÛŒ",price:40000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ Ú¯ÛŒØ§Ù‡ÛŒ Ø²Ø¹ÙØ±Ø§Ù†ÛŒ",price:45000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ø¢ÛŒØ³ Ù…Ø§Ù†Ú©ÛŒ",price:50000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ø¢Ù„ÙˆÙˆØ±Ø§",price:42000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ù„ÛŒÙ…ÙˆÙ†Ø§Ø¯ Ø´ÛŒØ´Ù‡ Ø§ÛŒ",price:35000,category:"Ù…ØªÙØ±Ù‚Ù‡"},
  {name:"Ø¨Ø·Ø±ÛŒ Û± Ù„ÛŒØªØ±ÛŒ Ø¢Ø¨ Ù‡ÙˆÛŒØ¬",price:80000,category:"Ø¨Ø·Ø±ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø·Ø±ÛŒ Û± Ù„ÛŒØªØ±ÛŒ Ø¢Ø¨ Ø·Ø§Ù„Ø¨ÛŒ",price:140000,category:"Ø¨Ø·Ø±ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø·Ø±ÛŒ Û± Ù„ÛŒØªØ±ÛŒ Ø¢Ø¨ Ø³ÛŒØ¨",price:180000,category:"Ø¨Ø·Ø±ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø·Ø±ÛŒ Û± Ù„ÛŒØªØ±ÛŒ Ø¢Ø¨ Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡",price:120000,category:"Ø¨Ø·Ø±ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø·Ø±ÛŒ Û± Ù„ÛŒØªØ±ÛŒ Ø¢Ø¨ Ù¾Ø±ØªØºØ§Ù„",price:200000,category:"Ø¨Ø·Ø±ÛŒâ€ŒÙ‡Ø§"},
  {name:"Ø¨Ø·Ø±ÛŒ Û± Ù„ÛŒØªØ±ÛŒ Ø´ÛŒØ± Ù…ÙˆØ²",price:180000,category:"Ø¨Ø·Ø±ÛŒâ€ŒÙ‡Ø§"}
];

// ====== Ø­Ø§Ù„Øª Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ù„ÛŒ ======
const categories = [...new Set(productsData.map(p=>p.category))];
let cart = []; // {name, price, qty, category}
const LS_KEY = 'doyaar_cart_v1';

// Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§
const catScroll = document.getElementById('catScroll');
const prodSheet = document.getElementById('prodSheet');
const prodGrid = document.getElementById('prodGrid');
const closeProducts = document.getElementById('closeProducts');
const searchBar = document.getElementById('searchBar');
const searchResults = document.getElementById('searchResults');
const invList = document.getElementById('invList');
const emptyNote = document.getElementById('emptyNote');
const totalSum = document.getElementById('totalSum');
const itemsCount = document.getElementById('itemsCount');
const cartCountTop = document.getElementById('cartCountTop');
const cartTotalTop = document.getElementById('cartTotalTop');
const printBtnMobile = document.getElementById('printBtnMobile');
const emptyCartBtnMobile = document.getElementById('emptyCartBtnMobile');
const checkoutBtn = document.getElementById('checkoutBtn');
const clearSearchBtn = document.getElementById('clearSearch');
const closeBtn = document.getElementById('closeProducts');

// Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ
function updateTime(){ document.getElementById('currentTime').textContent = new Date().toLocaleTimeString(); }
setInterval(updateTime,1000); updateTime();

// Ù„ÙˆØ¯ Ø§Ø² localStorage
function loadCart(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw) cart = JSON.parse(raw);
    else cart=[];
  }catch(e){cart=[];}
  updateCartUI();
}

// Ø³ÛŒÙˆ Ø¨Ù‡ localStorage
function saveCart(){ localStorage.setItem(LS_KEY, JSON.stringify(cart)); }

// Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯
function addToCartByObj(product){
  const found = cart.find(it=>it.name === product.name);
  if(found) found.qty++;
  else cart.push({...product, qty:1});
  saveCart(); updateCartUI();
}

// Ø­Ø°Ù Ø§Ø² Ø³Ø¨Ø¯ Ú©Ø§Ù…Ù„
function removeFromCart(name){
  cart = cart.filter(it=>it.name !== name);
  saveCart(); updateCartUI();
}

// Ú©Ù… Ú©Ø±Ø¯Ù†
function decrement(name){
  const it = cart.find(x=>x.name===name);
  if(!it) return;
  it.qty--;
  if(it.qty <= 0) removeFromCart(name);
  else { saveCart(); updateCartUI(); }
}

// (Ø¬Ù…Ø¹) Ø§ÙØ²Ø§ÛŒØ´
function increment(name){
  const it = cart.find(x=>x.name===name);
  if(!it) return;
  it.qty++;
  saveCart(); updateCartUI();
}

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø±Ù†Ø¯Ø± Ø³Ø¨Ø¯
function updateCartUI(){
  invList.innerHTML='';
  if(cart.length === 0){
    emptyNote.style.display='block';
  } else {
    emptyNote.style.display='none';
    cart.forEach(it=>{
      const row = document.createElement('div');
      row.className = 'inv-item';
      row.innerHTML = `
        <div style="width:48%"><div class="name">${escapeHtml(it.name)}</div><small>${it.category}</small></div>
        <div style="width:18%;text-align:center">
          <div class="qty-controls" style="display:flex;justify-content:center;align-items:center">
            <button data-name="${escapeHtml(it.name)}" class="dec">-</button>
            <span style="padding:0 6px;font-weight:800">${it.qty}</span>
            <button data-name="${escapeHtml(it.name)}" class="inc">+</button>
          </div>
        </div>
        <div style="width:22%;text-align:left">${numberWithCommas(it.price * it.qty)} ØªÙˆÙ…Ø§Ù†</div>
      `;
      invList.appendChild(row);
      // event delegation handled below
    });
  }

  const total = cart.reduce((s,i)=>s + i.price * i.qty, 0);
  const items = cart.reduce((s,i)=>s + i.qty, 0);
  totalSum.textContent = numberWithCommas(total) + ' ØªÙˆÙ…Ø§Ù†';
  itemsCount.textContent = items;
  cartCountTop.textContent = items;
  cartTotalTop.textContent = numberWithCommas(total);
  saveCart();
}

// escape Ø¨Ø±Ø§ÛŒ Ù…Ø­ØªÙˆØ§Ù‡Ø§ÛŒ HTML
function escapeHtml(s){ return (''+s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }

// Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª ÛŒÚ© Ø¯Ø³ØªÙ‡ Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ù¾Ø§ÛŒÛŒÙ†
function openCategory(cat){
  prodGrid.innerHTML = '';
  const list = productsData.filter(p=>p.category === cat);
  list.forEach(p=>{
    const card = document.createElement('button');
    card.className='prod-card';
    card.innerHTML = `<div>${escapeHtml(p.name)}</div><div class="prod-price">${numberWithCommas(p.price)} ØªÙˆÙ…Ø§Ù†</div>`;
    card.addEventListener('click', ()=> {
      addToCartByObj(p);
      // Ø§ÙÚ©Øª Ú©ÙˆØªØ§Ù‡
      card.style.transform='scale(0.98)';
      setTimeout(()=>card.style.transform='scale(1)',120);
    });
    prodGrid.appendChild(card);
  });
  prodSheet.style.display='block';
  prodSheet.setAttribute('aria-hidden','false');
  setTimeout(()=>prodSheet.style.bottom='76px',10);
}

// Ø¨Ø³ØªÙ† Ù¾Ù†Ø¬Ø±Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
closeBtn.addEventListener('click', ()=>{ prodSheet.style.display='none'; prodSheet.setAttribute('aria-hidden','true'); });

// Ø±Ù†Ø¯Ø± Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ (Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ)
function renderCategories(){
  catScroll.innerHTML='';
  categories.forEach(cat=>{
    const b = document.createElement('button');
    b.className='cat-btn';
    b.textContent = cat;
    b.addEventListener('click', ()=> {
      // active visual
      Array.from(catScroll.children).forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      openCategory(cat);
    });
    catScroll.appendChild(b);
  });
}

// Ø¬Ø³ØªØ¬Ùˆ (Ù‡Ø§ÛŒÙ„Ø§ÛŒØª) â€” Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† Ù„ÛŒØ³Øª Ø¨Ø§Ø² Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†
function highlight(text, query){
  if(!query) return escapeHtml(text);
  try{
    const q = query.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    const re = new RegExp('('+q+')','gi');
    return escapeHtml(text).replace(re, `<span class="highlight">$1</span>`);
  }catch(e){
    return escapeHtml(text);
  }
}

// Ø±Ù†Ø¯Ø± Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ
let lastSearch = '';
searchBar.addEventListener('input', ()=>{
  const valRaw = searchBar.value.trim();
  const val = valRaw.replace(/Ø¢/g,'Ø§');
  lastSearch = valRaw;
  if(!val){ searchResults.style.display='none'; return; }
  const filtered = productsData.filter(p=> p.name.replace(/Ø¢/g,'Ø§').includes(val) );
  searchResults.innerHTML='';
  filtered.forEach(p=>{
    const div = document.createElement('div');
    div.className='search-item';
    const left = document.createElement('div');
    left.innerHTML = `${highlight(p.name, valRaw)} <div style="font-size:12px;color:#999;margin-top:4px">${p.category} â€” ${numberWithCommas(p.price)} ØªÙˆÙ…Ø§Ù†</div>`;
    const btn = document.createElement('button');
    btn.textContent = '+';
    btn.addEventListener('click', (e)=>{
      addToCartByObj(p);
      // ÙÙ‚Ø· ÙÛŒÙ„Ø¯ Ø®Ø§Ù„ÛŒ Ø´ÙˆØ¯ Ø§Ù…Ø§ Ù„ÛŒØ³Øª Ø¨Ø§Ø² Ø¨Ù…Ø§Ù†Ø¯
      searchBar.value = '';
      lastSearch='';
      // maintain results: recompute (will likely show none)
      searchResults.style.display = 'none';
      searchResults.innerHTML='';
      searchBar.focus();
    });
    div.appendChild(left);
    div.appendChild(btn);
    searchResults.appendChild(div);
  });
  searchResults.style.display = filtered.length ? 'block' : 'none';
});

// Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¬Ø³ØªØ¬Ùˆ
clearSearchBtn.addEventListener('click', ()=>{
  searchBar.value=''; searchResults.style.display='none'; lastSearch='';
});

// ØªØ¹Ø§Ù…Ù„ Ø±ÙˆÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ (Ø±ÙˆÛŒØ¯Ø§Ø¯ delegate)
invList.addEventListener('click', function(e){
  const t = e.target;
  if(t.matches('button.dec')){
    const name = t.getAttribute('data-name');
    decrement(name);
  } else if(t.matches('button.inc')){
    const name = t.getAttribute('data-name');
    increment(name);
  }
});

// Ø¹Ù…Ù„ÛŒØ§Øª Ú†Ø§Ù¾ (Ù¾Ù†Ø¬Ø±Ù‡â€ŒÛŒ Ú†Ø§Ù¾)
printBtnMobile.addEventListener('click', ()=>{
  const printBody = document.getElementById('printBody');
  printBody.innerHTML = '';
  if(cart.length===0){ alert('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª'); return; }
  cart.forEach(it=>{
    const p = document.createElement('div');
    p.style.display='flex';
    p.style.justifyContent='space-between';
    p.style.marginBottom='6px';
    p.innerHTML = `<div>${escapeHtml(it.name)} x${it.qty}</div><div>${numberWithCommas(it.price*it.qty)} ØªÙˆÙ…Ø§Ù†</div>`;
    printBody.appendChild(p);
  });
  document.getElementById('printTotal').textContent = numberWithCommas(cart.reduce((s,i)=>s+i.qty*i.price,0));
  document.getElementById('printDate').textContent = new Date().toLocaleString();
  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² iframe Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ Ø¨Ù‡ØªØ± Ù…ÙˆØ¨Ø§ÛŒÙ„/Ø¯Ø³Ú©ØªØ§Ù¾
  const printContent = document.getElementById('invoicePrint').innerHTML;
  const newWin = window.open('','_blank','width=400,height=600');
  newWin.document.write('<html><head><meta charset="utf-8"><title>Ø±Ø³ÛŒØ¯</title></head><body style="font-family:sans-serif;padding:12px">'+printContent+'</body></html>');
  newWin.document.close();
  setTimeout(()=>{ newWin.focus(); newWin.print(); /* newWin.close(); */ },500);
});

// Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯Ù† Ø³Ø¨Ø¯
emptyCartBtnMobile.addEventListener('click', ()=>{
  cart = []; saveCart(); updateCartUI();
});

// Ø«Ø¨Øª ÙØ§Ú©ØªÙˆØ± (Ø´Ø¨ÛŒÙ‡ Ú©Ø±Ø¯Ù† Ø«Ø¨Øª)
checkoutBtn.addEventListener('click', ()=>{
  if(cart.length===0){ alert('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª'); return; }
  // Ø³Ø§Ø®Øª Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ± Ø³Ø§Ø¯Ù‡
  const invoiceNo = 'F' + Date.now().toString().slice(-6);
  // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ: ÙÙ‚Ø· Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ùˆ Ú†Ø§Ù¾
  printBtnMobile.click();
  cart = [];
  saveCart();
  updateCartUI();
  alert('ÙØ§Ú©ØªÙˆØ± Ø«Ø¨Øª Ø´Ø¯ â€” Ø´Ù…Ø§Ø±Ù‡: ' + invoiceNo);
});

// ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§ Ú©Ø§Ù…Ø§
function numberWithCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// init
renderCategories();
loadCart();

// Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ: Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø³ØªÙ‡ Ø®ÙˆØ¯Ú©Ø§Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
// openCategory(categories[0]); document.querySelector('.cat-btn')?.classList.add('active');

</script>
</body>
</html>
